<!DOCTYPE html>
<html lang="fr" class="theme-dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BSH Zone - Crypto & Obfuscation Toolkit</title>

    <meta name="monetag" content="6a2c69a120ce554b4bea1e00810358c9">
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6051132636993805"
         crossorigin="anonymous"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Styles Tailwind customis√©s pour les th√®mes */
        .theme-dark {
            --bg-primary: #1e293b;
            --bg-secondary: #0f172a;
            --text-primary: #f8fafc;
            --border-color: #334155;
            --shadow-color: rgba(0, 0, 0, 0.4);
        }
        .theme-light {
            --bg-primary: #f1f5f9;
            --bg-secondary: #ffffff;
            --text-primary: #0f172a;
            --border-color: #e2e8f0;
            --shadow-color: rgba(0, 0, 0, 0.1);
        }
        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
        }
        .bg-card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 6px -1px var(--shadow-color), 0 2px 4px -2px var(--shadow-color);
        }
        .input-area {
            background-color: var(--bg-primary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
        }
        .cipher-card-selected {
            border: 3px solid #3b82f6; /* Bleu indigo pour la s√©lection */
            transform: scale(1.02);
        }
    </style>
</head>
<body id="body" class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300">

    <div class="min-h-screen p-4 md:p-8">
        <header class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-extrabold text-indigo-500 tracking-wider">BSH ZONE <span class="text-lg font-light text-gray-400">Toolkit</span></h1>
            
            <div class="flex items-center space-x-4">
                <span class="text-sm text-gray-400">Th√®me</span>
                <button id="themeToggle" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors duration-300">
                    <svg id="sunIcon" class="h-6 w-6 text-yellow-500 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>
                    <svg id="moonIcon" class="h-6 w-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>
                </button>
            </div>
        </header>
        
        <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <div class="lg:col-span-1">
                <h2 class="text-xl font-bold mb-4 text-indigo-400">Modes de Chiffrement & Obfuscation</h2>
                <div id="cipherCardsContainer" class="space-y-4">
                    
                    <h3 class="text-lg font-semibold mt-6 text-cyan-400 border-b border-gray-700 pb-2">Cryptographie Classique</h3>
                    
                    <div id="Vigenere" data-cipher="Vigenere" class="other-cipher-card bg-card p-4 rounded-xl transition duration-300 hover:shadow-xl hover:border-indigo-500/50 cursor-pointer">
                        <div class="flex justify-between items-center">
                            <p class="font-semibold">Vigen√®re</p>
                            <button class="px-3 py-1 text-sm rounded-full text-white bg-cyan-700 hover:bg-cyan-800 transition">Utiliser</button>
                        </div>
                    </div>
                    <div id="Caesar" data-cipher="Caesar" class="other-cipher-card bg-card p-4 rounded-xl transition duration-300 hover:shadow-xl hover:border-indigo-500/50 cursor-pointer">
                        <div class="flex justify-between items-center">
                            <p class="font-semibold">C√©sar</p>
                            <button class="px-3 py-1 text-sm rounded-full text-white bg-cyan-700 hover:bg-cyan-800 transition">Utiliser</button>
                        </div>
                    </div>
                    <div id="ROT13" data-cipher="ROT13" class="other-cipher-card bg-card p-4 rounded-xl transition duration-300 hover:shadow-xl hover:border-indigo-500/50 cursor-pointer">
                        <div class="flex justify-between items-center">
                            <p class="font-semibold">ROT13</p>
                            <button class="px-3 py-1 text-sm rounded-full text-white bg-cyan-700 hover:bg-cyan-800 transition">Utiliser</button>
                        </div>
                    </div>
                    <div id="Affine" data-cipher="Affine" class="other-cipher-card bg-card p-4 rounded-xl transition duration-300 hover:shadow-xl hover:border-indigo-500/50 cursor-pointer">
                        <div class="flex justify-between items-center">
                            <p class="font-semibold">Affine</p>
                            <button class="px-3 py-1 text-sm rounded-full text-white bg-cyan-700 hover:bg-cyan-800 transition">Utiliser</button>
                        </div>
                    </div>
                    
                    <h3 class="text-lg font-semibold mt-6 text-indigo-400 border-b border-gray-700 pb-2">Obfuscation JavaScript / Encodage</h3>

                    <div id="ObfuscationStringArray" data-cipher="ObfuscationStringArray" class="other-cipher-card bg-card p-4 rounded-xl transition duration-300 hover:shadow-xl hover:border-indigo-500/50 cursor-pointer">
                        <div class="flex justify-between items-center">
                            <p class="font-semibold">Obfuscation (String Array) üõ†Ô∏è</p>
                            <button class="px-3 py-1 text-sm rounded-full text-white bg-indigo-700 hover:bg-indigo-800 transition">Utiliser</button>
                        </div>
                    </div>
                     <div id="ObfuscationStringArrayPro" data-cipher="ObfuscationStringArrayPro" class="other-cipher-card bg-card p-4 rounded-xl transition duration-300 hover:shadow-xl hover:border-indigo-500/50 cursor-pointer">
                        <div class="flex justify-between items-center">
                            <p class="font-semibold">Obfuscation (String Array Pro) üîí</p>
                            <button class="px-3 py-1 text-sm rounded-full text-white bg-indigo-700 hover:bg-indigo-800 transition">Utiliser</button>
                        </div>
                    </div>
                    <div id="ObfuscationCJK" data-cipher="ObfuscationCJK" class="other-cipher-card bg-card p-4 rounded-xl transition duration-300 hover:shadow-xl hover:border-indigo-500/50 cursor-pointer">
                        <div class="flex justify-between items-center">
                            <p class="font-semibold">Obfuscation (CJK / Unicode) üáØüáµ</p>
                            <button class="px-3 py-1 text-sm rounded-full text-white bg-indigo-700 hover:bg-indigo-800 transition">Utiliser</button>
                        </div>
                    </div>
                    <div id="ObfuscationSplit" data-cipher="ObfuscationSplit" class="other-cipher-card bg-card p-4 rounded-xl transition duration-300 hover:shadow-xl hover:border-indigo-500/50 cursor-pointer">
                        <div class="flex justify-between items-center">
                            <p class="font-semibold">Obfuscation (Division de Cha√Æne)</p>
                            <button class="px-3 py-1 text-sm rounded-full text-white bg-indigo-700 hover:bg-indigo-800 transition">Utiliser</button>
                        </div>
                    </div>
                    <div id="ObfuscationDistract" data-cipher="ObfuscationDistract" class="other-cipher-card bg-card p-4 rounded-xl transition duration-300 hover:shadow-xl hover:border-indigo-500/50 cursor-pointer">
                        <div class="flex justify-between items-center">
                            <p class="font-semibold">Obfuscation (Code Mort)</p>
                            <button class="px-3 py-1 text-sm rounded-full text-white bg-indigo-700 hover:bg-indigo-800 transition">Utiliser</button>
                        </div>
                    </div>
                    <div id="ObfuscationEncode" data-cipher="ObfuscationEncode" class="other-cipher-card bg-card p-4 rounded-xl transition duration-300 hover:shadow-xl hover:border-indigo-500/50 cursor-pointer">
                        <div class="flex justify-between items-center">
                            <p class="font-semibold">Obfuscation (Base64 Eval)</p>
                            <button class="px-3 py-1 text-sm rounded-full text-white bg-indigo-700 hover:bg-indigo-800 transition">Utiliser</button>
                        </div>
                    </div>
                    <div id="Base64" data-cipher="Base64" class="other-cipher-card bg-card p-4 rounded-xl transition duration-300 hover:shadow-xl hover:border-indigo-500/50 cursor-pointer">
                        <div class="flex justify-between items-center">
                            <p class="font-semibold">Encodage (Base64)</p>
                            <button class="px-3 py-1 text-sm rounded-full text-white bg-cyan-700 hover:bg-cyan-800 transition">Utiliser</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="lg:col-span-2 space-y-8">
                
                <div class="bg-card p-6 rounded-xl">
                    <h2 id="cipherTitle" class="text-2xl font-bold text-white mb-2">Outil Vigen√®re (Cryptage)</h2>
                    <p id="cipherDescription" class="text-gray-400">Mode actuel : Chiffrement Vigen√®re. Cryptez votre texte ou un fichier ZIP avec un mot de passe (cl√© textuelle).</p>
                    <div id="statusMessage" class="mt-4"></div>
                </div>
                
                <div class="bg-card p-6 rounded-xl">
                    <h3 class="text-xl font-semibold mb-3">Texte/Code d'Entr√©e</h3>
                    <textarea id="inputText" rows="8" class="input-area w-full p-3 rounded-lg text-sm transition focus:ring-2 focus:ring-indigo-500" placeholder="Entrez le texte ou le code JavaScript √† crypter/obfusquer ici..."></textarea>
                    
                    <div class="mt-4 space-y-3">
                        <div id="keyInputContainer">
                            <label for="keyInput" id="keyLabel" class="block text-sm font-medium mb-1">Mot de Passe (Cl√© Textuelle)</label>
                            <input type="text" id="keyInput" value="SECRET" class="input-area w-full p-2 rounded-lg text-sm transition focus:ring-2 focus:ring-indigo-500">
                        </div>
                        
                        <div id="keyInputBContainer" class="hidden">
                            <label for="keyInputB" class="block text-sm font-medium mb-1">Cl√© Multiplicative (A: doit √™tre coprime de 26)</label>
                            <input type="number" id="keyInputB" value="5" class="input-area w-full p-2 rounded-lg text-sm transition focus:ring-2 focus:ring-indigo-500">
                        </div>

                        <div id="zipUploadContainer" class="flex items-center space-x-4 pt-2">
                             <input type="file" id="zipFileInput" accept=".zip" class="text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
                             <span id="zipInfo" class="text-xs text-yellow-500 hidden">(Fichier charg√© en Base64 dans la zone de texte)</span>
                        </div>
                    </div>
                    
                    <button id="encryptButton" class="w-full mt-5 px-4 py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition duration-300 shadow-md">
                        Crypter le Message
                    </button>
                </div>
                
                <div class="bg-card p-6 rounded-xl">
                    <h3 class="text-xl font-semibold mb-3">R√©sultat (Crypt√© / Obfusqu√©)</h3>
                    <textarea id="outputText" rows="10" readonly class="input-area w-full p-3 rounded-lg text-sm transition"></textarea>
                    
                    <div id="resultActions" class="flex justify-end space-x-3 mt-4 opacity-0 invisible transition-opacity duration-500">
                        <button id="copyButton" class="flex items-center space-x-2 px-4 py-2 bg-gray-600 text-white text-sm font-semibold rounded-lg hover:bg-gray-700 transition">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5v2m0-2h8m-4 0h1M9 16h6m-4 4h-2"/></svg>
                            <span>Copier</span>
                        </button>
                        <button id="downloadButton" class="flex items-center space-x-2 px-4 py-2 bg-indigo-600 text-white text-sm font-semibold rounded-lg hover:bg-indigo-700 transition">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>
                            <span>T√©l√©charger</span>
                        </button>
                    </div>
                </div>
            </div>
            
        </main>
        
        <footer class="mt-12 text-center text-sm text-gray-500 border-t border-gray-700 pt-6">
            <p>&copy; 2024 BSH Zone Toolkit - Crypto & Obfuscation. Tous droits r√©serv√©s.</p>
        </footer>
    </div>
    
    <script>
    // --- UTILITAIRES D'OBFUSCATION ---

    // Fonction pour cr√©er une cha√Æne de distraction simulant le Code Mort (inchang√©e)
    function createDistractionCode(key, size = 150) {
        const distraction = "/* START OPAQUE CODE INJECTION - BSH ZONE */\n";
        let junk = "";
        const randomChar = '0123456789abcdef';

        for (let i = 0; i < size; i++) {
            const charBased = key.charAt(i % key.length);
            junk += `const _0x${Math.floor(Math.random() * 0xFFFF).toString(16)} = '${charBased}' + '${randomChar.charAt(Math.floor(Math.random() * 16))}' + '${Math.random().toFixed(4)}';\n`;
        }

        return distraction + junk + `/* END OPAQUE CODE INJECTION - KEY HASH: ${key.length * 42} */\n`;
    }

    // Fonction d'Obfuscation par Division de Cha√Æne (inchang√©e)
    function stringSplitObfuscator(text) {
        if (!text) return "";
        const charArray = Array.from(text); 
        const jsArray = "['" + charArray.join("','") + "']";
        const obfuscatedCode = `// String Splitting Obfuscation\nconst obfuscatedString = (${jsArray}).join('');\n// L'utilisation est: console.log(obfuscatedString);`;
        return obfuscatedCode;
    }

    // Fonctions Base64 (conserv√©es pour les modes qui en d√©pendent)
    function base64EncodeSafe(text) {
        const utf8 = new TextEncoder().encode(text);
        const binary = String.fromCharCode.apply(null, utf8);
        return btoa(binary);
    }
    function base64DecodeSafe(base64) {
        const binaryString = atob(base64);
        const decoded_utf8 = decodeURIComponent(binaryString.split('').map(function(c) {
            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        }).join(''));
        return decoded_utf8;
    }


    // FONCTION MIS √Ä JOUR : Obfuscation de Cha√Æne de Style Professionnel (String Array - SANS Base64)
    function stringArrayObfuscator(text) {
        if (!text) return "// Entrez du code ou du texte pour commencer l'obfuscation String Array.";

        // 1. Pr√©paration du tableau de cha√Ænes
        const originalString = text;
        const obfuscatedStrings = [
            'eval', 
            'log',         
            'Code ex√©cut√© avec succ√®s. Longueur: ',
            originalString 
        ];

        // 2. Masquage des cha√Ænes par division et s√©paration non-Base64
        const splitDelimiter = '@@@'; // Nouveau d√©limiteur unique
        const splitArray = obfuscatedStrings.map(str => str.split('').join(splitDelimiter));
        const rawEscapedArray = JSON.stringify(splitArray); 

        // 3. D√©finition des Noms de Variables Hexad√©cimales (style Obfuscator.io)
        const VAR_DICT = '_0xaa1b22';
        const FUNC_DECODE = '_0xcc3d44';
        const KEY_EVAL = '_0xee5f66';
        const KEY_LOG = '_0x7a8b9c';
        const KEY_SOURCE = '_0x9d0e1f';
        const VAR_LOG_MSG = '_0x1a2b3c';
        
        // 4. Routine de d√©codage (utilise split/join pour reconstituer les cha√Ænes)
        const decoderRoutine = `
    // Routine de d√©chiffrement BSH Zone (String Splitting)
    const ${VAR_DICT} = (function() {
        const _bsh_split_array = ${rawEscapedArray}; 
        const _decoded_array = [];
        
        for (let i = 0; i < _bsh_split_array.length; i++) {
            // Recombinaison en utilisant le d√©limiteur pour inverser l'op√©ration
            _decoded_array.push(_bsh_split_array[i].split('${splitDelimiter}').join(''));
        }
        
        return _decoded_array;
    })();

    // Fonction d'acc√®s au tableau de cha√Ænes
    const ${FUNC_DECODE} = function(index) {
        return ${VAR_DICT}[index];
    };
    `;
        
        // 5. Code obfusqu√© final
        const obfuscatedCode = `
    /* * üîí BSH ZONE : OBFO-STRINGARRAY (Mise √† jour: String Splitting) 
     * Masque les cha√Ænes et utilise des variables hexad√©cimales.
     */
    (function() {
        ${decoderRoutine}

        // R√©cup√©ration des fonctions critiques via le tableau par index
        const ${KEY_EVAL} = window[${FUNC_DECODE}(0)] || window['eval']; 
        const ${KEY_LOG} = ${FUNC_DECODE}(1); 
        const ${VAR_LOG_MSG} = ${FUNC_DECODE}(2);

        // Acc√®s √† la cha√Æne du code source par index
        const ${KEY_SOURCE} = ${FUNC_DECODE}(3); 
        
        // Ex√©cution du code masqu√©
        try {
            ${KEY_EVAL}(${KEY_SOURCE}); 
            
            // Simuler l'affichage de succ√®s
            console[${KEY_LOG}](${VAR_LOG_MSG} + ${KEY_SOURCE}.length);
        } catch (e) {
            console['error']('‚ùå String Array Erreur: √âchec de l\\'ex√©cution.', e);
        }
    })();
    `;
        return obfuscatedCode;
    }


    // FONCTION Obfuscation String Array Pro (SANS BASE64) - CONSERV√âE
    function stringArrayProObfuscator(text) {
        if (!text) return "// Entrez du code ou du texte (ex: console.log('Hello');) pour commencer l'obfuscation String Array Pro.";
        
        const originalString = text;
        const obfuscatedStrings = [
            'eval', 
            'log',  
            'Code ex√©cut√© avec succ√®s. Longueur: ',
            originalString 
        ];
        
        const splitDelimiter = '|||'; 
        const splitArray = obfuscatedStrings.map(str => str.split('').join(splitDelimiter));
        const rawEscapedArray = JSON.stringify(splitArray); 

        const VAR_DICT = '_0x3d0a4c';
        const FUNC_DECODE = '_0x9f1b2e';
        const KEY_EVAL = '_0x6c7d8f';
        const KEY_LOG = '_0xa1b2c3';
        const KEY_SOURCE = '_0x4e5f60';
        const VAR_LOG_MSG = '_0x7a8b9c';

        const decoderRoutine = `
    // Routine de d√©chiffrement SANS BASE64 (BSH Zone)
    const ${VAR_DICT} = (function() {
        const _bsh_split_array = ${rawEscapedArray}; 
        const _decoded_array = [];
        
        for (let i = 0; i < _bsh_split_array.length; i++) {
            _decoded_array.push(_bsh_split_array[i].split('${splitDelimiter}').join(''));
        }
        
        return _decoded_array;
    })();

    const ${FUNC_DECODE} = function(index) {
        return ${VAR_DICT}[index];
    };
    `;
        
        const obfuscatedCode = `
    /* * üîí BSH ZONE : OBFO-STRINGARRAY-PRO (SANS CRYPTAGE/BASE64) 
     * Masque les cha√Ænes par division et substitution d'index (Style Obfuscator.io)
     */
    (function() {
        ${decoderRoutine}

        const ${KEY_EVAL} = window[${FUNC_DECODE}(0)] || window['eval']; 
        const ${KEY_LOG} = ${FUNC_DECODE}(1); 
        const ${VAR_LOG_MSG} = ${FUNC_DECODE}(2);
        const ${KEY_SOURCE} = ${FUNC_DECODE}(3); 
        
        try {
            ${KEY_EVAL}(${KEY_SOURCE}); 
            console[${KEY_LOG}](${VAR_LOG_MSG} + ${KEY_SOURCE}.length);
        } catch (e) {
            console['error']('‚ùå String Array Pro Erreur: √âchec de l\\'ex√©cution.', e);
        }
    })();
    `;
        return obfuscatedCode;
    }


    // FONCTION Obfuscation CJK (Unicode pur) (inchang√©e)
    function cjkObfuscator(text) {
        if (!text) return "// Entrez du code ou du texte pour commencer l'obfuscation CJK.";

        const sourceCodeVar = 'Ê©üÂØÜ„ÇΩ„Éº„Çπ„Ç≥„Éº„Éâ'; 
        const evalFunc = 'ÂÆüË°åË©ï‰æ°';         
        
        const escapedText = JSON.stringify(text); 
        
        const obfuscatedCode = `
    /* * üáØüáµ Obfuscation CJK (Unicode pur) - BSH Zone 
     */

    const ${sourceCodeVar} = ${escapedText};
    const ${evalFunc} = window['eval']; 
        
    try {
        ${evalFunc}(${sourceCodeVar});
        console.log('‚úÖ CJK Obfuscation: Code source visible mais ex√©cut√© par une variable illisible. Longueur: ' + ${sourceCodeVar}.length);
    } catch (e) {
        console.error('‚ùå Erreur CJK: √âchec de l\\'ex√©cution. Assurez-vous que le code source est valide.', e);
    }
    `;
        return obfuscatedCode;
    }

    // FONCTION Obfuscation Base64 simple (CONSERV√âE)
    function obfuscationEncodeCipher(text) {
         if (!text) return "// Entrez du code ou du texte (ex: console.log('Hello');) pour commencer l'obfuscation Base64.";
         const base64 = base64EncodeSafe(text);
         return `/* Obfuscation Base64 Simple (BSH Zone) */\nconst _base64 = '${base64}';\neval(base64DecodeSafe(_base64));\n// Note: La fonction base64DecodeSafe doit √™tre d√©finie dans votre environnement.`;
    }


    // --- VARIABLES ET S√âLECTION DOM (INCHANG√âE) ---

    let currentCipher = 'Vigenere'; 

    const body = document.getElementById('body');
    const themeToggle = document.getElementById('themeToggle');
    const sunIcon = document.getElementById('sunIcon');
    const moonIcon = document.getElementById('moonIcon');
    const cipherTitle = document.getElementById('cipherTitle');
    const cipherDescription = document.getElementById('cipherDescription');

    const inputText = document.getElementById('inputText');
    const outputText = document.getElementById('outputText');

    const keyInputContainer = document.getElementById('keyInputContainer');
    const keyLabel = document.getElementById('keyLabel');
    const keyInput = document.getElementById('keyInput');

    const keyInputBContainer = document.getElementById('keyInputBContainer');
    const keyInputB = document.getElementById('keyInputB');

    const encryptButton = document.getElementById('encryptButton'); 

    const zipUploadContainer = document.getElementById('zipUploadContainer');
    const zipFileInput = document.getElementById('zipFileInput');
    const zipInfo = document.getElementById('zipInfo');

    const resultActions = document.getElementById('resultActions');
    const copyButton = document.getElementById('copyButton');
    const downloadButton = document.getElementById('downloadButton');
    const statusMessage = document.getElementById('statusMessage');

    const cipherCardsContainer = document.getElementById('cipherCardsContainer');


    // --- UTILITAIRES / ALGOS DE CHIFFREMENT/ENCODAGE (INCHANG√âS) ---

    function vigenereCipher(text, key, mode = 'encrypt') {
        const cleanedKey = key.toUpperCase().replace(/[^A-Z]/g, '');
        if (cleanedKey.length === 0) return "KEY_ERROR"; 
        let result = '';
        let keyIndex = 0; 
        const keyLength = cleanedKey.length;
        const direction = mode === 'encrypt' ? 1 : -1; 
        for (let i = 0; i < text.length; i++) {
            const char = text[i];
            let charCode = text.charCodeAt(i);
            let isUpperCase = (charCode >= 65 && charCode <= 90); 
            let isLowerCase = (charCode >= 97 && charCode <= 122); 
            if (isUpperCase || isLowerCase) {
                const keyCharShift = (cleanedKey.charCodeAt(keyIndex % keyLength) - 65) * direction; 
                let base = isUpperCase ? 65 : 97; 
                let originalPos = charCode - base; 
                let newPos = (originalPos + keyCharShift + 26) % 26; 
                result += String.fromCharCode(newPos + base);
                keyIndex++;
            } else {
                result += char;
            }
        }
        return result;
    }

    function caesarCipher(text, shift, mode = 'encrypt') {
        const numShift = parseInt(shift) * (mode === 'encrypt' ? 1 : -1);
        if (isNaN(numShift)) return "KEY_ERROR";
        let result = '';
        const finalShift = (numShift % 26 + 26) % 26; 
        for (let i = 0; i < text.length; i++) {
            const charCode = text.charCodeAt(i);
            let base = 0;
            if (charCode >= 65 && charCode <= 90) { base = 65; } 
            else if (charCode >= 97 && charCode <= 122) { base = 97; } 
            else { result += text[i]; continue; }
            let originalPos = charCode - base;
            let newPos = (originalPos + finalShift) % 26;
            result += String.fromCharCode(newPos + base);
        }
        return result;
    }

    function rot13Cipher(text) {
        return caesarCipher(text, 13, 'encrypt');
    }

    function affineCipher(text, a, b, mode = 'encrypt') {
        const A = parseInt(a);
        const B = parseInt(b);
        if (isNaN(A) || isNaN(B) || A < 1 || A > 25 || B < 0 || B > 25) return "KEY_ERROR";
        if ([1, 3, 5, 7, 9, 11, 15, 17, 19, 21, 23, 25].indexOf(A) === -1) return "KEY_ERROR_A"; 
        let result = '';
        let A_inv = 0;
        if (mode === 'decrypt') {
            for (let i = 0; i < 26; i++) {
                if ((A * i) % 26 === 1) { A_inv = i; break; }
            }
        }
        for (let i = 0; i < text.length; i++) {
            const charCode = text.charCodeAt(i);
            let base = 0;
            if (charCode >= 65 && charCode <= 90) { base = 65; } 
            else if (charCode >= 97 && charCode <= 122) { base = 97; } 
            else { result += text[i]; continue; }
            let x = charCode - base;
            let y;
            if (mode === 'encrypt') { y = (A * x + B) % 26; } 
            else { y = (A_inv * (x - B + 26)) % 26; }
            result += String.fromCharCode(y + base);
        }
        return result;
    }

    function substitutionCipher(text, key, mode = 'encrypt') {
        const cleanedKey = key.toUpperCase().replace(/[^A-Z]/g, '');
        if (cleanedKey.length !== 26 || new Set(cleanedKey).size !== 26) return "KEY_ERROR";
        const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        const keyMap = mode === 'encrypt' 
            ? Array.from(alphabet).reduce((map, char, i) => { map[char] = cleanedKey[i]; return map; }, {})
            : Array.from(cleanedKey).reduce((map, char, i) => { map[char] = alphabet[i]; return map; }, {});
        let result = '';
        for (let i = 0; i < text.length; i++) {
            const char = text[i];
            const upperChar = char.toUpperCase();
            if (alphabet.includes(upperChar)) {
                const substitutedChar = keyMap[upperChar];
                result += (char === upperChar) ? substitutedChar : substitutedChar.toLowerCase();
            } else {
                result += char;
            }
        }
        return result;
    }

    function base64Cipher(text) {
        return base64EncodeSafe(text);
    }


    // --- GESTION DES MODES DE CHIFFREMENT (UI - INCHANG√âE) ---

    function updateCipherUI(cipherName) {
        currentCipher = cipherName;
        
        // R√©initialisation
        outputText.value = '';
        statusMessage.innerHTML = '';
        toggleResultActions('');
        keyInputBContainer.classList.add('hidden');
        keyInputContainer.classList.remove('hidden'); 
        zipInfo.classList.add('hidden'); 
        
        // Logique de s√©lection de la carte stylis√©e
        document.querySelectorAll('.other-cipher-card').forEach(card => {
            card.classList.remove('cipher-card-selected');
            card.querySelector('button').textContent = 'Utiliser';
            card.querySelector('button').classList.remove('bg-indigo-600', 'hover:bg-indigo-700', 'bg-indigo-700', 'hover:bg-indigo-800', 'bg-cyan-600');
            card.querySelector('button').classList.add('bg-cyan-700', 'hover:bg-cyan-800');
            card.querySelector('button').classList.remove('shadow-md');
        });
        const activeCard = document.getElementById(cipherName);
        activeCard.classList.add('cipher-card-selected');
        activeCard.querySelector('button').textContent = 'Mode Actif';
        
        // Mise √† jour de l'UI
        switch (cipherName) {
            case 'Vigenere':
                cipherTitle.textContent = "Outil Vigen√®re (Cryptage)";
                cipherDescription.textContent = "Mode actuel : Chiffrement Vigen√®re. Cryptez votre texte ou un fichier ZIP avec un mot de passe (cl√© textuelle).";
                keyLabel.textContent = "Mot de Passe (Cl√© Textuelle)";
                keyInput.type = "text";
                keyInput.value = "SECRET";
                encryptButton.textContent = "Crypter le Message";
                activeCard.querySelector('button').classList.remove('bg-cyan-700', 'hover:bg-cyan-800');
                activeCard.querySelector('button').classList.add('bg-cyan-600', 'shadow-md');
                break;
            case 'Caesar':
                cipherTitle.textContent = "Outil Chiffrement de C√©sar (Cryptage)";
                cipherDescription.textContent = "Mode actuel : Chiffrement de C√©sar. Chiffrement par d√©calage num√©rique simple.";
                keyLabel.textContent = "D√©calage (0-25)";
                keyInput.type = "number";
                keyInput.value = "3";
                encryptButton.textContent = "Crypter le Message";
                break;
            case 'ROT13':
                cipherTitle.textContent = "Outil Chiffrement ROT13 (Cryptage)";
                cipherDescription.textContent = "Mode actuel : Chiffrement ROT13. Cas sp√©cial de C√©sar, d√©calage fixe de 13 positions.";
                keyInputContainer.classList.add('hidden'); 
                encryptButton.textContent = "Crypter le Message";
                break;
            case 'Affine':
                cipherTitle.textContent = "Outil Chiffrement Affine (Cryptage)";
                cipherDescription.textContent = "Mode actuel : Chiffrement Affine. Utilise deux cl√©s num√©riques A (multiplicative) et B (additive).";
                keyLabel.textContent = "Cl√© Additive (B: 0-25)";
                keyInput.type = "number";
                keyInput.value = "3";
                keyInputBContainer.classList.remove('hidden'); 
                encryptButton.textContent = "Crypter le Message";
                break;
            case 'Substitution':
                cipherTitle.textContent = "Outil Chiffrement par Substitution (Cryptage)";
                cipherDescription.textContent = "Mode actuel : Chiffrement par Substitution. Chaque lettre est remplac√©e selon une cl√© de 26 lettres.";
                keyLabel.textContent = "Cl√© de Substitution (26 lettres uniques)";
                keyInput.type = "text";
                keyInput.value = "QWERTYUIOPASDFGHJKLZXCVBNM";
                encryptButton.textContent = "Crypter le Message";
                break;
            case 'Base64':
                cipherTitle.textContent = "Outil Encodage Base64 (Encodage)";
                cipherDescription.textContent = "Mode actuel : Encodage Base64. Convertit le texte en un format de cha√Æne Base64 pour le transport de donn√©es binaires.";
                keyInputContainer.classList.add('hidden'); 
                encryptButton.textContent = "Encoder le Message";
                activeCard.querySelector('button').textContent = 'Mode Actif (Encodage)';
                activeCard.querySelector('button').classList.remove('bg-cyan-700', 'hover:bg-cyan-800');
                activeCard.querySelector('button').classList.add('bg-cyan-600', 'shadow-md');
                break;
            
            // --- OBFUSCATION ---
            case 'ObfuscationStringArray':
                cipherTitle.textContent = "Outil Obfuscation (String Array) - MIS √Ä JOUR üõ†Ô∏è";
                cipherDescription.textContent = "Mode actuel : Obfuscation Professionnelle. Cache toutes les cha√Ænes d'entr√©e dans un tableau par **division de cha√Ænes** (m√©thode non Base64, style Obfuscator.io).";
                keyInputContainer.classList.add('hidden'); 
                encryptButton.textContent = "Obfusquer (String Array)";
                activeCard.querySelector('button').textContent = 'Mode Actif (Obfusquer)';
                activeCard.querySelector('button').classList.remove('bg-cyan-700', 'hover:bg-cyan-800');
                activeCard.querySelector('button').classList.add('bg-indigo-600', 'shadow-md');
                break;
            case 'ObfuscationStringArrayPro':
                cipherTitle.textContent = "Outil Obfuscation (String Array Pro) üîí (SANS BASE64)";
                cipherDescription.textContent = "Mode actuel : Obfuscation String Array Avanc√©e. Masque toutes les cha√Ænes **SANS Base64** par division/recombinaison et substitution d'index (identique au String Array simple pour l'instant).";
                keyInputContainer.classList.add('hidden'); 
                encryptButton.textContent = "Obfusquer (String Array Pro)";
                activeCard.querySelector('button').textContent = 'Mode Actif (Obfusquer)';
                activeCard.querySelector('button').classList.remove('bg-cyan-700', 'hover:bg-cyan-800');
                activeCard.querySelector('button').classList.add('bg-indigo-600', 'shadow-md');
                break;
            case 'ObfuscationCJK':
                cipherTitle.textContent = "Outil Obfuscation (CJK / Unicode) üáØüáµ";
                cipherDescription.textContent = "Mode actuel : Obfuscation CJK. Remplace le code par des variables en **caract√®res illisibles (Chinois/Japonais)** SANS Base64.";
                keyInputContainer.classList.add('hidden'); 
                encryptButton.textContent = "Obfusquer (CJK)";
                activeCard.querySelector('button').classList.remove('bg-cyan-700', 'hover:bg-cyan-800');
                activeCard.querySelector('button').classList.add('bg-indigo-600', 'shadow-md');
                break;
            case 'ObfuscationEncode':
                cipherTitle.textContent = "Outil Obfuscation (Base64 Eval)";
                cipherDescription.textContent = "Mode actuel : Obfuscation. Encode le texte d'entr√©e en **Base64** et ex√©cution par 'eval'.";
                keyInputContainer.classList.add('hidden'); 
                encryptButton.textContent = "Obfusquer (Base64 Eval)";
                activeCard.querySelector('button').classList.remove('bg-cyan-700', 'hover:bg-cyan-800');
                activeCard.querySelector('button').classList.add('bg-indigo-600', 'shadow-md');
                break;
            case 'ObfuscationDistract':
                cipherTitle.textContent = "Outil Obfuscation (Code Mort/Distraction)";
                cipherDescription.textContent = "Mode actuel : Obfuscation. Ajoute du code mort (variables inutiles) autour du texte pour simuler une pollution de code.";
                keyLabel.textContent = "Texte/Mot cl√© pour la Distraction";
                keyInput.type = "text";
                keyInput.value = "CRITICAL_PHRASE";
                encryptButton.textContent = "Obfusquer (Distraire)";
                activeCard.querySelector('button').classList.remove('bg-cyan-700', 'hover:bg-cyan-800');
                activeCard.querySelector('button').classList.add('bg-indigo-600', 'shadow-md');
                break;
            case 'ObfuscationSplit':
                cipherTitle.textContent = "Outil Obfuscation (Division de Cha√Æne)";
                cipherDescription.textContent = "Mode actuel : Obfuscation. Divise le message en tableau de caract√®res JavaScript, puis le recombine.";
                keyInputContainer.classList.add('hidden'); 
                encryptButton.textContent = "Obfusquer (Split)";
                activeCard.querySelector('button').classList.remove('bg-cyan-700', 'hover:bg-cyan-800');
                activeCard.querySelector('button').classList.add('bg-indigo-600', 'shadow-md');
                break;
        }
    }

    cipherCardsContainer.addEventListener('click', (event) => {
        const card = event.target.closest('.other-cipher-card');
        if (card && card.dataset.cipher) {
            updateCipherUI(card.dataset.cipher);
        }
    });


    // --- GESTION DU CHIFFREMENT GLOBAL (LOGIQUE MISE √Ä JOUR) ---

    function handleCipherAction() {
        const mode = 'encrypt'; 
        let text = inputText.value;
        const key = keyInput.value;
        let encryptedText = '';
        let keyB = keyInputB.value; 

        // V√©rifications d'entr√©e
        const isObfuscationMode = currentCipher.includes('Obfuscation');

        if (!text && !isObfuscationMode) {
            showStatus("Veuillez entrer du texte √† crypter/obfusquer/encoder.", 'error');
            outputText.value = "";
            toggleResultActions("");
            return;
        }
        if (!text && isObfuscationMode) {
            // Utilisation d'un placeholder pour l'obfuscation si la zone de texte est vide.
            text = "console.log('Ceci est la fonction critique √† masquer.');"; 
        }
        
        try {
            switch (currentCipher) {
                case 'Vigenere':
                    encryptedText = vigenereCipher(text, key, mode);
                    if (encryptedText === "KEY_ERROR") throw new Error("Cl√© Vigen√®re invalide (doit contenir des lettres).");
                    break;
                case 'Caesar':
                    encryptedText = caesarCipher(text, key, mode);
                    if (encryptedText === "KEY_ERROR") throw new Error("D√©calage C√©sar invalide (doit √™tre un nombre).");
                    break;
                case 'ROT13':
                    encryptedText = rot13Cipher(text);
                    break;
                case 'Affine':
                    encryptedText = affineCipher(text, keyB, key, mode);
                    if (encryptedText === "KEY_ERROR") throw new Error("Cl√©s Affine invalides (doivent √™tre des nombres 0-25).");
                    if (encryptedText === "KEY_ERROR_A") throw new Error("Cl√© A (multiplicative) doit √™tre coprime de 26.");
                    break;
                case 'Substitution':
                    encryptedText = substitutionCipher(text, key, mode);
                    if (encryptedText === "KEY_ERROR") throw new Error("Cl√© de Substitution invalide (doit contenir 26 lettres uniques A-Z).");
                    break;
                case 'Base64': 
                    encryptedText = base64Cipher(text);
                    break;
                
                // --- OBFUSCATION ---
                case 'ObfuscationStringArray':
                    // NOUVELLE FONCTION SANS Base64
                    encryptedText = stringArrayObfuscator(text);
                    break;
                case 'ObfuscationStringArrayPro':
                    // Utilise la fonction Pro (aussi sans Base64 pour des raisons de s√©curit√©)
                    encryptedText = stringArrayProObfuscator(text); 
                    break;
                case 'ObfuscationCJK':
                    encryptedText = cjkObfuscator(text); 
                    break;
                case 'ObfuscationEncode':
                    encryptedText = obfuscationEncodeCipher(text);
                    break;
                case 'ObfuscationDistract':
                    const distractionCode = createDistractionCode(key, 100);
                    encryptedText = distractionCode + "\n\n/* REAL CODE START */\n" + text + "\n/* REAL CODE END */\n\n" + distractionCode;
                    break;
                case 'ObfuscationSplit':
                    encryptedText = stringSplitObfuscator(text);
                    break;
            }
        } catch (e) {
             showStatus("Erreur : " + e.message, 'error');
             outputText.value = "";
             toggleResultActions("");
             return;
        }

        const actionType = isObfuscationMode ? 'obfusqu√©' : (currentCipher === 'Base64' ? 'encod√©' : 'crypt√©');
        outputText.value = encryptedText;
        showStatus(`Message ${actionType} avec succ√®s !`);
        toggleResultActions(encryptedText);
    }

    encryptButton.addEventListener('click', handleCipherAction);


    // --- LOGIQUE ZIP (INCHANG√âE) ---

    zipFileInput.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (file) {
            if (file.type !== 'application/zip') {
                showStatus("Veuillez s√©lectionner un fichier ZIP valide.", 'error');
                zipInfo.classList.add('hidden');
                inputText.value = '';
                zipFileInput.value = '';
                return;
            }
            
            const reader = new FileReader();
            reader.onload = (e) => {
                const base64Content = e.target.result.split(',')[1]; 
                inputText.value = base64Content; 
                
                const isEncodingMode = currentCipher === 'Base64' || currentCipher.includes('Obfuscation');
                const infoMessage = isEncodingMode 
                    ? `Fichier "${file.name}" charg√© et encod√© en Base64. (Le mode actuel est un encodage ou une obfuscation.)`
                    : `Fichier "${file.name}" charg√© et encod√© en Base64. Le chiffrement ${currentCipher} sera appliqu√© sur la Base64.`;

                showStatus(infoMessage, 'info');
                
                zipInfo.classList.remove('hidden');
                toggleResultActions('');
                
                zipFileInput.value = ''; 
            };
            reader.readAsDataURL(file); 
        }
    });


    // --- LOGIQUE DE BASE (Th√®me, Copier/T√©l√©charger - INCHANG√âE) ---

    if (localStorage.getItem('theme') === 'light') setTheme('light'); else setTheme('dark');
    themeToggle.addEventListener('click', () => {
        const currentTheme = body.classList.contains('theme-dark') ? 'dark' : 'light';
        setTheme(currentTheme === 'dark' ? 'light' : 'dark');
    });

    function setTheme(theme) {
        const htmlTag = document.documentElement; 

        if (theme === 'light') {
            body.classList.remove('theme-dark'); body.classList.add('theme-light');
            htmlTag.style.backgroundColor = '#f3f4f6'; 
            moonIcon.classList.add('hidden'); sunIcon.classList.remove('hidden');
            localStorage.setItem('theme', 'light');
        } else {
            body.classList.remove('theme-light'); body.classList.add('theme-dark');
            htmlTag.style.backgroundColor = '#0d1117'; 
            sunIcon.classList.add('hidden'); moonIcon.classList.remove('hidden');
            localStorage.setItem('theme', 'dark');
        }
    }

    // Messages d'√©tat stylis√©s
    function showStatus(message, type = 'success') {
        let baseClasses = 'p-3 rounded-xl text-sm font-medium transition duration-300 ease-in-out shadow-lg flex items-center justify-center gap-2 transform hover:scale-[1.01]';
        let icon, colorClasses;
        if (type === 'success') { colorClasses = 'bg-green-600 hover:bg-green-700 text-white'; icon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" /></svg>'; } 
        else if (type === 'error') { colorClasses = 'bg-red-600 hover:bg-red-700 text-white'; icon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.3 16c-.77 1.333.192 3 1.732 3z" /></svg>'; } 
        else if (type === 'info') { colorClasses = 'bg-blue-600 hover:bg-blue-700 text-white'; icon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>'; }
        else { colorClasses = 'bg-blue-600 hover:bg-blue-700 text-white'; icon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>'; }

        statusMessage.innerHTML = `<div class="${baseClasses} ${colorClasses}">${icon}<span>${message}</span></div>`;
        setTimeout(() => { statusMessage.innerHTML = ''; }, 6000); 
    }

    // Affichage des actions avec transition
    function toggleResultActions(text) {
         if (text.length > 0) {
            resultActions.classList.remove('opacity-0', 'invisible');
            resultActions.classList.add('opacity-100', 'visible');
        } else {
            resultActions.classList.remove('opacity-100', 'visible');
            resultActions.classList.add('opacity-0', 'invisible');
        }
    }

    copyButton.addEventListener('click', () => {
        outputText.select(); 
        document.execCommand('copy'); 
        showStatus("R√©sultat copi√© dans le presse-papiers ! üìã", 'success');
    });

    downloadButton.addEventListener('click', () => {
        const encryptedText = outputText.value;
        if (!encryptedText) {
            showStatus("Aucun r√©sultat √† t√©l√©charger.", 'error');
            return;
        }
        const blob = new Blob([encryptedText], { type: 'text/plain;charset=utf-8' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `message_${currentCipher.toLowerCase()}_bsh.txt`; 
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        showStatus("Fichier t√©l√©charg√© avec succ√®s ! üíæ");
    });

    document.addEventListener('DOMContentLoaded', () => {
        updateCipherUI('Vigenere');
    });
    </script>
</body>
</html>
